---
# Production Inventory - Studio ERP
# Aggiorna l'IP dopo provisioning Hetzner

all:
  children:
    production:
      hosts:
        studio-erp-prod:
          ansible_host: 116.203.109.249  # IP Hetzner (romanoing.com)
          ansible_port: 22
          ansible_user: root
          ansible_python_interpreter: /usr/bin/python3

      vars:
        env: production
        app_domain: romanoing.com

        # Application
        app_name: studio-erp
        app_user: studioerp
        app_group: studioerp
        app_directory: /opt/romanoing  # Directory base dove viene clonato il repo
        app_repository: https://github.com/romanobenit/romanoing.git
        app_repository_branch: production

        # SSL/TLS
        letsencrypt_email: admin@romanoing.com

        # Hetzner CPX32 (8 vCPU dedicated AMD EPYC, 16GB RAM, 160GB SSD)
        hetzner_server_type: cpx32
        hetzner_location: nbg1  # Norimberga (Germania, EU)
        hetzner_image: ubuntu-24.04

        # PostgreSQL (ottimizzato per 16GB RAM)
        postgresql_version: "16"
        postgresql_database: studio_erp_production
        postgresql_user: studioerp
        postgresql_port: 5432
        postgresql_listen_addresses: "localhost"
        postgresql_max_connections: 200
        postgresql_shared_buffers: "4GB"  # 25% di 16GB RAM
        postgresql_effective_cache_size: "12GB"  # 75% di 16GB RAM

        # Node.js
        nodejs_version: "20"

        # Applicazione (ottimizzata per 8 vCPU)
        app_port: 3000
        app_workers: 8  # pm2 instances (1 per vCPU, sfrutta tutti i core dedicati)

        # Nginx (ottimizzato per 8 vCPU)
        nginx_worker_processes: 8  # 1 worker per vCPU
        nginx_client_max_body_size: "10M"

        # SSL
        ssl_protocols: "TLSv1.2 TLSv1.3"
        ssl_ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"

        # Monitoring (più retention grazie a 160GB storage)
        prometheus_version: "2.45.0"
        node_exporter_version: "1.6.1"
        postgres_exporter_version: "0.13.2"
        prometheus_retention: "30d"  # aumentato da 15d grazie a maggiore storage
        grafana_port: 3001

        # Backup
        backup_retention_days: 30
        backup_time: "03:00"
        backup_storage_box: "u123456.your-storagebox.de"  # ← Hetzner Storage Box hostname

        # System
        locale: "it_IT.UTF-8"
        timezone: "Europe/Rome"
        ssh_port: 22
